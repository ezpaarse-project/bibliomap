# bibliomap

Bibliomap is a tool for real-time viewing in the browser localised usage events generated by [ezPAARSE](https://github.com/ezpaarse-project/ezpaarse).

How could it be useful ?
  * For real-time monitoring your ezproxy EC consultations 
  * For helping ezpaarse adoption in your institution.
  * And just for fun !

![anim](https://cloud.githubusercontent.com/assets/328244/19802257/11855392-9d03-11e6-9338-e35893ecddfc.gif)

[Demonstration on the CNRS subscribed electronic ressources usage statistics](http://bibliomap.inist.fr/)

## Usage options

### Expo mode

In expo mode, the description popup will automatically show and hide at determined intervals. To activate it, add `expo` or `e` in the querystring. By default, the popup will be shown for **1 minute**, then hidden for **10 minutes**. To define custom intervals, `expo` should take two numbers separated by a comma. The first one is the time shown, the second is the time hidden. Times are defined in **seconds**.

Examples:
  - http://bibliomap.inist.fr?expo (activates default expo mode: 1min shown / 10 min hidden)
  - http://bibliomap.inist.fr?e (the same but with a shortcut)  
  - http://bibliomap.inist.fr?expo=20,120 (activates customized expo mode: 20 sec shown / 120 sec hidden)  

## Technical architecture

Bibliomap uses these softwares:
  * [bibliomap-harvester](https://github.com/ezpaarse-project/bibliomap-harvester) for real-time listening lines of log comming from ezproxys
  * [bibliomap-enricher](https://github.com/ezpaarse-project/bibliomap-enricher) listening for bibliomap-harvester data, sending it to ezpaarse and sending the result to you this bibliomap
  * [bibliomap-viewer](https://github.com/ezpaarse-project/bibliomap-viewer) for the front end web interface showing ezPAARSE EC's in real time thanks to websocket protocol
  * [Log.io](http://logio.org/) protocol for all the communication between these scripts

<p align="center">
<img src="https://docs.google.com/drawings/d/1bkxEEBL1kLzH76dkIYFzspYHOVajDjQHCijU3mxJLnM/pub?w=694&h=519" />
</p>

## Prerequisites

  * Docker and docker-compose

  * Load the configuration file which define your project settings (setup_*.sh)

## Installation and running a quick demo

```
# Clone the repository
git clone https://github.com/ezpaarse-project/bibliomap.git
cd bibliomap

# Load one configuration file
. ./setup_cnrs.sh # Or . ./setup_istex.sh

# Start the tool
npm start
```

Then browse to http://127.0.0.1:50197

## Developers

## Installation for developing

```
# Clone all the required repositories
git clone https://github.com/ezpaarse-project/bibliomap.git
cd bibliomap
git clone https://github.com/ezpaarse-project/bibliomap-harvester.git
git clone https://github.com/ezpaarse-project/bibliomap-enricher.git
git clone https://github.com/ezpaarse-project/bibliomap-viewer.git

# Load one configuration file
. ./setup_cnrs.sh # Or . ./setup_istex.sh

# Install dependencies & Start the tool
npm run install
npm run start-debug
```

Then browse to http://127.0.0.1:50197


### Upgrade

To upgrade to the latest version of [bibliomap-harvester](https://github.com/ezpaarse-project/bibliomap-harvester), [bibliomap-enricher](https://github.com/ezpaarse-project/bibliomap-enricher), and [bibliomap-viewer](https://github.com/ezpaarse-project/bibliomap-viewer) in the docker-compose.yml, just git clone all of these into your bibliomap/ folder (see just above) and run this command:

```
npm version patch
```
